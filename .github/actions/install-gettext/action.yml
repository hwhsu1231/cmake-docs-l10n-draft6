# Distributed under the OSI-approved BSD 3-Clause License.
# See accompanying file LICENSE.txt for details.

name: install-gettext

description: Install Gettext

inputs:
  token:
    required: false
    description: xxx
    default: '${{ github.token }}'

runs:
  using: composite
  steps:
    - name: Install Gettext by Apt (Ubuntu)
      if: ${{ runner.os == 'Linux' }}
      shell: bash
      run: |
        sudo apt install gettext

    - name: Install Gettext by Homebrew (macOS)
      if: ${{ runner.os == 'macOS' }}
      shell: bash
      run: |
        brew install gettext

    - name: Install Gettext by Conda (Windows)
      if: ${{ runner.os == 'Windows' }}
      shell: powershell
      run: |
        conda install gettext --channel conda-forge

    # - name: Install Winget (Windows)
    #   if: ${{ runner.os == 'Windows' }}
    #   uses: Cyberboss/install-winget@v1
    #   with:
    #     GITHUB_TOKEN: ${{ inputs.token }}

    # - name: Install Gettext by Winget (Windows)
    #   if: ${{ runner.os == 'Windows' }}
    #   shell: powershell
    #   run: |
    #     winget install mlocati.GetText --accept-source-agreements --accept-package-agreements
    #     echo "C:\Program Files\gettext-iconv\bin" | Out-File -FilePath $env:GITHUB_PATH -Encoding utf8 -Append

    - name: Check if Gettext is installed (Linux/macOS)
      if: ${{ runner.os == 'Linux' || runner.os == 'macOS' }}
      shell: bash
      run: |
        which xgettext
        xgettext --version

    - name: Check if Gettext is installed (Windows)
      if: ${{ runner.os == 'Windows' }}
      shell: cmd
      run: |
        echo dir C:\Miniconda 
        dir C:\Miniconda
        echo CONDA_PREFIX = %CONDA_PREFIX%
        where xgettext
        xgettext --version
